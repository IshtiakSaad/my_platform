---
import { getCollection } from 'astro:content';
import BaseLayout from '../layout/BaseLayout.astro';

// 1. Fetch Data (Replacing INITIAL_ARTICLES)
const allPosts = await getCollection('blog', ({ data }) => {
  return data.draft !== true;
});

// Helper to sort by date
const sortPosts = (posts) => posts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

// 2. Filter Categories (Matching your React Logic)
const techArticles = sortPosts(allPosts.filter(p => p.data.category === 'Tech'));
const philosophyArticles = sortPosts(allPosts.filter(p => p.data.category === 'Philosophy'));
const psychArticles = sortPosts(allPosts.filter(p => p.data.category === 'Psychology'));
const econArticles = sortPosts(allPosts.filter(p => p.data.category === 'Economics'));

// 3. Fallbacks (To prevent crash if a category is empty)
const techFeatured = techArticles[0];
const techStandard = techArticles.slice(1, 3); // Get next 2
---

<BaseLayout title="Home - Ishtiak Saad">
  
  <section class="py-20 md:py-32 grid grid-cols-12 gap-8 items-end border-b border-editorial-border">
    <div class="col-span-12 lg:col-span-8">
      <h1 class="text-5xl md:text-8xl font-bold leading-[0.95] mb-6 text-editorial-text tracking-tight font-serif">
        Decoding the human condition in the digital age.
      </h1>
    </div>
    <div class="col-span-12 lg:col-span-4 lg:pb-4 border-l border-editorial-border/0 lg:border-editorial-border pl-0 lg:pl-8">
      <p class="text-xl md:text-2xl text-editorial-muted font-light italic leading-relaxed font-serif">
        Independent perspectives on Technology, Psychology, and Economics.
      </p>
      <div class="mt-8 w-12 h-[1px] bg-editorial-accent"></div>
    </div>
  </section>

  <div class="grid grid-cols-1 md:grid-cols-12 border-b border-editorial-border">
    
    <section class="md:col-span-8 py-12 md:pr-12 border-r-0 md:border-r border-editorial-border">
      <div class="flex items-center justify-between mb-10 pb-4 border-b border-editorial-border">
        <h2 class="text-3xl font-serif italic text-editorial-text">Technology</h2>
        <a href="/tech" class="text-[10px] font-bold uppercase tracking-widest text-editorial-text hover:text-editorial-accent flex items-center gap-2 group transition-colors font-sans">
          View All <span class="material-symbols-outlined text-sm group-hover:translate-x-1 transition-transform">arrow_forward</span>
        </a>
      </div>

      <div class="grid grid-cols-1 gap-16">
        {techFeatured && (
          <a href={`/posts/${techFeatured.slug}`} class="group block">
            <div class="flex flex-col gap-4">
              <div class="flex items-center gap-3 text-[10px] font-bold uppercase tracking-widest text-editorial-muted font-sans">
                <span>{techFeatured.data.pubDate.toLocaleDateString()}</span>
                <span class="w-1 h-[1px] bg-editorial-border"></span>
                <span>Essay</span>
              </div>
              <h3 class="text-4xl md:text-5xl font-serif font-bold text-editorial-text leading-tight max-w-2xl link-underline">
                {techFeatured.data.title} <span class="hidden group-hover:inline-block text-editorial-accent ml-2 transition-opacity">â†’</span>
              </h3>
              <p class="text-editorial-muted leading-relaxed max-w-xl text-lg font-serif">
                {techFeatured.data.description}
              </p>
            </div>
          </a>
        )}

        <div class="grid grid-cols-1 md:grid-cols-2 gap-12 pt-12 border-t border-editorial-border/30">
          {techStandard.map(post => (
            <a href={`/posts/${post.slug}`} class="group flex flex-col gap-3">
              <div class="flex items-center gap-3 text-[10px] font-bold uppercase tracking-widest text-editorial-muted font-sans">
                <span>{post.data.pubDate.toLocaleDateString()}</span>
              </div>
              <h3 class="text-xl font-serif font-bold text-editorial-text link-underline">{post.data.title}</h3>
            </a>
          ))}
        </div>
      </div>
    </section>

    <section class="md:col-span-4 py-12 md:pl-12 flex flex-col h-full">
      <div class="flex items-center justify-between mb-10 pb-4 border-b border-editorial-border">
        <h2 class="text-3xl font-serif italic text-editorial-text">Philosophy</h2>
        <a href="/philosophy" class="text-[10px] font-bold uppercase tracking-widest text-editorial-text hover:text-editorial-accent flex items-center gap-2 group transition-colors font-sans">
          View All <span class="material-symbols-outlined text-sm group-hover:translate-x-1 transition-transform">arrow_forward</span>
        </a>
      </div>
      
      <div class="flex flex-col gap-12 h-full">
        {philosophyArticles.slice(0, 2).map(post => (
          <a href={`/posts/${post.slug}`} class="group block">
            <div class="flex flex-col gap-3">
              <div class="flex items-center gap-3 text-[10px] font-bold uppercase tracking-widest text-editorial-muted font-sans">
                <span>{post.data.pubDate.toLocaleDateString()}</span>
              </div>
              <h3 class="text-2xl font-serif font-bold text-editorial-text link-underline leading-snug">{post.data.title}</h3>
              <p class="text-sm text-editorial-muted leading-relaxed mt-1 font-serif">{post.data.description}</p>
            </div>
          </a>
        ))}
        <div class="flex-grow hidden md:block border-l border-editorial-border/30 ml-2 pl-6 pt-6">
          <p class="text-xs text-editorial-muted italic font-serif">"Philosophy is the microscope of thought."</p>
        </div>
      </div>
    </section>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-12">
    
    <section class="md:col-span-5 py-12 md:pr-12 border-r-0 md:border-r border-editorial-border">
      <div class="flex items-center justify-between mb-10 pb-4 border-b border-editorial-border">
        <h2 class="text-3xl font-serif italic text-editorial-text">Psychology</h2>
        <a href="/psychology" class="text-[10px] font-bold uppercase tracking-widest text-editorial-text hover:text-editorial-accent flex items-center gap-2 group transition-colors font-sans">
          View All <span class="material-symbols-outlined text-sm group-hover:translate-x-1 transition-transform">arrow_forward</span>
        </a>
      </div>
      <div class="flex flex-col gap-10">
        {psychArticles[0] && (
          <a href={`/posts/${psychArticles[0].slug}`} class="group block">
            <div class="flex flex-col gap-3">
              <div class="flex items-center gap-3 text-[10px] font-bold uppercase tracking-widest text-editorial-muted font-sans">
                <span>{psychArticles[0].data.pubDate.toLocaleDateString()}</span>
              </div>
              <h3 class="text-3xl font-serif font-bold text-editorial-text link-underline leading-tight">{psychArticles[0].data.title}</h3>
            </div>
          </a>
        )}
        
        {psychArticles[1] && (
          <div class="pt-8 border-t border-editorial-border/30">
             <a href={`/posts/${psychArticles[1].slug}`} class="group block">
                <div class="flex flex-col gap-3">
                  <div class="flex items-center gap-3 text-[10px] font-bold uppercase tracking-widest text-editorial-muted font-sans">
                    <span>{psychArticles[1].data.pubDate.toLocaleDateString()}</span>
                  </div>
                  <h3 class="text-xl font-serif font-bold text-editorial-text link-underline leading-snug">{psychArticles[1].data.title}</h3>
                </div>
            </a>
          </div>
        )}
      </div>
    </section>

    <section class="md:col-span-7 py-12 md:pl-12">
      <div class="flex items-center justify-between mb-10 pb-4 border-b border-editorial-border">
        <h2 class="text-3xl font-serif italic text-editorial-text">Economics</h2>
        <a href="/economics" class="text-[10px] font-bold uppercase tracking-widest text-editorial-text hover:text-editorial-accent flex items-center gap-2 group transition-colors font-sans">
          View All <span class="material-symbols-outlined text-sm group-hover:translate-x-1 transition-transform">arrow_forward</span>
        </a>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-12">
        {econArticles.slice(0, 2).map(post => (
          <a href={`/posts/${post.slug}`} class="group flex flex-col gap-4">
            <div class="flex items-center gap-3 text-[10px] font-bold uppercase tracking-widest text-editorial-muted font-sans">
               <span>{post.data.pubDate.toLocaleDateString()}</span>
            </div>
            <h3 class="text-2xl font-serif font-bold text-editorial-text link-underline">{post.data.title}</h3>
            <p class="text-sm text-editorial-muted leading-relaxed font-serif">{post.data.description}</p>
          </a>
        ))}
      </div>
    </section>
  </div>

  <section class="mt-20 relative overflow-hidden bg-white border border-editorial-border px-8 py-16 md:px-20 md:py-24 max-w-5xl mx-auto rounded-sm">
    <div class="absolute top-0 right-0 w-1/3 h-full bg-gradient-to-l from-editorial-accent/10 to-transparent pointer-events-none"></div>
    <div class="relative z-10 grid grid-cols-1 md:grid-cols-2 gap-16 items-center">
      <div>
        <div class="flex items-center gap-4 mb-8 text-editorial-accent">
          <span class="w-8 h-[1px] bg-editorial-accent"></span>
          <span class="text-[10px] font-bold uppercase tracking-[0.3em] font-sans">The Sunday Digest</span>
        </div>
        <h2 class="text-4xl md:text-5xl font-serif font-bold text-editorial-text mb-6 leading-tight">Join 15,000+ curious minds.</h2>
        <p class="text-editorial-muted text-lg font-light leading-relaxed font-serif">
           Get my latest essays on the intersection of humanity and technology delivered straight to your inbox every Sunday.
        </p>
      </div>
      <div class="w-full">
        <form class="flex flex-col gap-4">
          <input class="w-full px-0 py-4 bg-transparent border-b border-editorial-border text-editorial-text placeholder-editorial-muted/50 focus:outline-none focus:border-editorial-accent transition-all text-lg font-serif" placeholder="Email Address" type="email"/>
          <button class="mt-4 self-start group flex items-center gap-4 text-editorial-text font-bold uppercase tracking-widest text-xs py-2 font-sans" type="button">
            <span>Subscribe for free</span>
            <span class="material-symbols-outlined text-editorial-accent group-hover:translate-x-2 transition-transform">arrow_right_alt</span>
          </button>
        </form>
        <p class="text-[10px] font-bold uppercase tracking-widest text-editorial-muted mt-12 opacity-60 font-sans">
           Read by leaders at Google, Stripe, and The Atlantic.
        </p>
      </div>
    </div>
  </section>

</BaseLayout>